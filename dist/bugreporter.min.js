/*
*
* Bug Reporter
* By Jack Childs 2021
*
* License: Apache 2.0
*
*/
const BugReporter={_consoleLog:window.console.log,_consoleError:window.console.error,_consoleWarn:window.console.warn,_consoleInfo:window.console.info,consoleOutput:[],_getCookies:function(){var cookies={};if(document.cookie&&""!=document.cookie)for(var split=document.cookie.split(";"),i=0;i<split.length;i++){var name_value=split[i].split("=");name_value[0]=name_value[0].replace(/^ /,""),cookies[decodeURIComponent(name_value[0])]=decodeURIComponent(name_value[1])}return cookies=={}?null:cookies},_getLocalStorage:function(){var obj={};return Object.keys(localStorage).forEach(key=>{obj[key]=localStorage.getItem(key)}),obj},_getSessionStorage:function(){var obj={};return Object.keys(sessionStorage).forEach(key=>{obj[key]=sessionStorage.getItem(key)}),obj},_getDateString:function(){const date=new Date,y=date.getFullYear(),m=date.getMonth(),d=date.getDate(),h=date.getHours(),min=date.getMinutes(),s=date.getSeconds(),ms=date.getMilliseconds();return`${y}-${m}-${d} ${h}:${min}:${s}:${ms}`},_getHTMLString:function(){var elementBackup=[];const copy=document.querySelectorAll("[data-bugreporter-hide]");copy.forEach(element=>{elementBackup.push([element])});for(let i=0;i<copy.length;i++)elementBackup[i][1]=BugReporter._getDOMLocation(copy[i]);for(let i=0;i<copy.length;i++)copy[i].parentNode.removeChild(copy[i]);var html=document.documentElement.outerHTML;for(let i=0;i<elementBackup.length;i++){const element=elementBackup[i][0],location=elementBackup[i][1];null===location[1]||(null===location[2]?location[0].insertBefore(element,null):location[0].insertBefore(element,location[2]))}return html},_getDOMLocation:function(e){return[e.parentNode,e.previousSibling,e.nextSibling]},_stringify:function(value){switch(typeof value){case"string":case"object":return JSON.stringify(value);default:return String(value)}},html2canvasSettings:{allowTaint:!0,useCORS:!0},generate:function(options,c){document.querySelectorAll("[data-bugreporter-hide]").forEach((function(el){el.style.visibility="hidden"}));const prefs={cookies:void 0===options.cookies||options.cookies,localStorage:void 0===options.localStorage||options.localStorage,sessionStorage:void 0===options.sessionStorage||options.sessionStorage,html:void 0===options.html||options.html,windowLocation:void 0===options.windowLocation||options.windowLocation,navigatorInfo:void 0===options.navigatorInfo||options.navigatorInfo,takeSnapshot:void 0===options.takeSnapshot||options.takeSnapshot,screenInfo:void 0===options.screenInfo||options.screenInfo,additionalInfo:void 0===options.additionalInfo?null:options.additionalInfo};prefs.takeSnapshot?html2canvas(document.body,this.html2canvasSettings).then((function(canvas){document.querySelectorAll("[data-bugreporter-hide]").forEach((function(el){el.style.visibility="visible"})),BugReporter._generateProcessData({prefs:prefs,img:canvas.toDataURL("image/png")},c)})):BugReporter._generateProcessData({prefs:prefs},c)},_generateProcessData:function(data,c){let dataToBeSent={pageSnapshot:void 0===data.img?null:data.img,dateTime:BugReporter._getDateString(),consoleOutput:BugReporter.consoleOutput,cookies:data.prefs.cookies?BugReporter._getCookies():null,localStorage:data.prefs.localStorage?BugReporter._getLocalStorage():null,sessionStorage:data.prefs.sessionStorage?BugReporter._getSessionStorage():null,html:data.prefs.html?BugReporter._getHTMLString():null,windowLocation:data.prefs.windowLocation?{href:window.location.href,pathname:window.location.pathname,host:window.location.host,hostname:window.location.hostname,port:window.location.port,protocol:window.location.protocol,origin:window.location.origin,hash:window.location.hash}:null,navigatorInfo:data.prefs.navigatorInfo?{cookieEnabled:navigator.cookieEnabled,language:navigator.language,hardwareConcurrency:navigator.hardwareConcurrency,vendor:navigator.vendor,userAgent:navigator.userAgent}:null,screenInfo:data.prefs.screenInfo?{width:window.screen.width,height:window.screen.height,availWidth:window.screen.availWidth,availHeight:window.screen.availHeight,colorDepth:window.screen.colorDepth,pixelDepth:window.screen.pixelDepth}:null,additionalInfo:data.prefs.additionalInfo};c(JSON.stringify(dataToBeSent))}};console.log=function(msg){BugReporter._consoleLog(msg),BugReporter.consoleOutput.push([BugReporter._getDateString(),BugReporter._stringify(msg),"console.log"])},console.warn=function(msg){BugReporter._consoleWarn(msg),BugReporter.consoleOutput.push([BugReporter._getDateString(),BugReporter._stringify(msg),"console.warn"])},console.error=function(msg){BugReporter._consoleError(msg),BugReporter.consoleOutput.push([BugReporter._getDateString(),BugReporter._stringify(msg),"console.error"])},console.info=function(msg){BugReporter._consoleInfo(msg),BugReporter.consoleOutput.push([BugReporter._getDateString(),BugReporter._stringify(msg),"console.info"])};